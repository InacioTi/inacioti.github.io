<p><img src="/img/posts/android-logo.png" alt="Pentesting Android" title="Pentesting Android" /></p>

<ul>
  <li><a href="#introdução">INTRODUÇÃO</a></li>
  <li><a href="#android-debug-bridge---adb">ANDROID DEBUG BRIDGE - ADB</a>
    <ul>
      <li><a href="#comandos-adb">Comandos ADB</a>
        <ul>
          <li><a href="#adb-shell">adb shell</a></li>
          <li><a href="#adb-install">adb install</a></li>
          <li><a href="#adb-shell-pm-list-packages">adb shell pm list packages</a></li>
          <li><a href="#adb-shell-logcat">adb shell logcat</a></li>
          <li><a href="#adb-pushpull">adb push/pull</a></li>
          <li><a href="#adb-reverse">adb reverse</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#conclusão">CONCLUSÃO</a></li>
</ul>

<h1 id="introdução">INTRODUÇÃO</h1>

<p>Dando continuidade aos artigos sobre pentesting mobile, este provavelmente será um dos menores posts da série, pois será introdutório para temas abordados mais adiante.</p>

<p>Como já vimos sobre elementos que fazem parte deste universo, agora vamos entender um pouco sobre uma das ferramentas mais úteis durante o processo de pentest Android, o <code class="language-plaintext highlighter-rouge">Android Debug Bridge</code>.<br />
Esta ferramenta nos permite não só interagir com o dispositivo ou AVD, como também fazer leitura de <code class="language-plaintext highlighter-rouge">logs</code>, que será muito importante em algumas fases.</p>

<h1 id="android-debug-bridge---adb">ANDROID DEBUG BRIDGE - ADB</h1>

<p><img src="/img/posts/mobile-09.png" alt="ADB" title="ADB" /></p>

<p>O <a href="https://developer.android.com/studio/command-line/adb?gclid=CjwKCAjwquWVBhBrEiwAt1KmwkBP7Qdm9rze8qqXlyhTCWrXVUZKhC32BQBp5o5ym5LRU29bKqJpURoCrToQAvD_BwE&amp;gclsrc=aw.ds">ADB</a> conforme descrito em sua documentação, é uma ferramenta de linha de comando que permite a comunicação com dispositivos.<br />
Para que a comunicação funcione, ele precisa de trrês elementos:</p>

<ul>
  <li><strong>Um client</strong>: que envia comandos. Este cliente é executado na máquina de desenvolvimento através de linha de comando;</li>
  <li><strong>Um daemon (adbd)</strong>: que executa comandos no dispositivo. Este daemon roda em background;</li>
  <li><strong>Um server</strong>: que administra a comunicação entre o client e o daemon. O server roda em background na máquina de desenvolvimento.</li>
</ul>

<p>A comunicação entre client e daemon pode ocorrer via conexão TCP ou serial através do USB.</p>

<p>Os dispositivos Android, por padrão possuem o daemon ADB instalado. Quando um dispositivo <code class="language-plaintext highlighter-rouge">emulado</code>, seja por <code class="language-plaintext highlighter-rouge">Android Studio</code>, <code class="language-plaintext highlighter-rouge">Genymotion</code> ou qualquer outro é chamado pelo ADB, normalmente a conexão é feita via TCP na porta 5555 do dispositivo, quando um dispositivo físico é espetado via USB, a conexão ocorre via USB.</p>

<p>A imagem abaixo, mostra a saída do comando <code class="language-plaintext highlighter-rouge">adb devices</code> que mostra os devices conectados, no caso abaixo, vemos um dispositivo emulado.</p>

<p><img src="/img/posts/mobile-10.png" alt="Dispositivos" title="Dispositivos" /></p>

<h2 id="comandos-adb">Comandos ADB</h2>

<p>A partir daqui, veremos alguns comandos úteis do ADB para a interação com o dispositivo.</p>

<h3 id="adb-shell">adb shell</h3>

<p>Talvez um dos comandos mais utilizados do ADB, o <code class="language-plaintext highlighter-rouge">adb shell</code> nos permite obter um shell interativo com o Sistema Operacional Android conectado via ADB.</p>

<p><img src="/img/posts/mobile-11.png" alt="Shell ADB" title="Shell ADB" /></p>

<p>Conforme podemos ver na imagem acima, temos um shell interativo com o dispositivo, onde o comando <code class="language-plaintext highlighter-rouge">su</code> nos permite executar comandos com privilégios de <code class="language-plaintext highlighter-rouge">root</code>, quando o SO permite, assim como em um <code class="language-plaintext highlighter-rouge">Linux</code>.</p>

<h3 id="adb-install">adb install</h3>

<p>O ADB também nos permite a instalação e desisntalação de aplicativos por linha de comando, para instalação utilizamos <code class="language-plaintext highlighter-rouge">adb install "path do apk"</code> conforme mostrado abaixo.</p>

<p><img src="/img/posts/mobile-12.png" alt="Instalando APK" title="Instalando APK" /></p>

<p>O aplicativo instalado faz parte do <a href="https://hakin9.org/evabs-extremely-vulnerable-android-labs/">EVABS (Extremaly Vulnerable Android Labs)</a>. No dispositivo, é possível encontrá-lo instalado, conforme mostrado abaixo.</p>

<p><img src="/img/posts/mobile-13.png" alt="Aplicativo instalado" title="Aplicativo instalado" /></p>

<h3 id="adb-shell-pm-list-packages">adb shell pm list packages</h3>

<p>Assim como instalar, o ADB nos permite listar todos os pacotes instalados em um dispositivo com o comando <code class="language-plaintext highlighter-rouge">pm</code> (Package Manager). Este comando pode ser executado tanto dentro do dispositivo, quando passado como argumento para o <code class="language-plaintext highlighter-rouge">adb shell</code> conforme mostrado na imagem abaixo.</p>

<p><img src="/img/posts/mobile-14.png" alt="Listando pacotes" title="Listando pacotes" /></p>

<p>A opção <code class="language-plaintext highlighter-rouge">-f</code> no comando também mostra o path de instalação do aplicativo, conforme mostrado abaixo.</p>

<p><img src="/img/posts/mobile-15.png" alt="Listando pacotes com path" title="Listando pacotes com path" /></p>

<h3 id="adb-shell-logcat">adb shell logcat</h3>

<p>Mais um dos comandos muito utilizados durante um teste, é o <code class="language-plaintext highlighter-rouge">logcat</code>. Este comando nos permite ler os logs do sistema Android em tempo de execução.</p>

<p><img src="/img/posts/mobile-16.png" alt="Logcat" title="Logcat" /></p>

<p>Podemos filtrar este log para vermos somente informações sobre um aplicativo em específico. Na imagem abaixo, filtramos pelo EVABS que instalamos.</p>

<p><img src="/img/posts/mobile-17.png" alt="Filtrando logcat" title="Filtrando logcat" /></p>

<h3 id="adb-pushpull">adb push/pull</h3>

<p>Muitas vezes durante um teste, é preciso transferir arquivos tanto da máquina pro dispositivo ou vice-versa. Para enviarmos um arquivo para o dispositivo, podemos utilizar a sintaxe <code class="language-plaintext highlighter-rouge">adb push "arquivo origem local" "path destino dispositivo"</code>. Na imagem abaixo, transferimos o arquivo “evil-mobile.txt” para dentro do diretório “/sdcard/Download” do dispositivo.</p>

<p><img src="/img/posts/mobile-18.png" alt="Enviando arquivos" title="Enviando arquivos" /></p>

<p>Já a sintaxe <code class="language-plaintext highlighter-rouge">adb pull "arquivo origem dispositivo" "path destino local"</code> nos permite transferir um arquivo do dispositivo para nossa máquina. A imagem abaixo mostra a transferência do arquivo “/sdcard/Download/evil-mobile2.txt” para nossa máquina.</p>

<p><img src="/img/posts/mobile-19.png" alt="Capturando arquivos" title="Capturando arquivos" /></p>

<h3 id="adb-reverse">adb reverse</h3>

<p>O comando <code class="language-plaintext highlighter-rouge">adb reverse</code> nos permite abrir um túnel entre uma porta do dispositivo e uma porta local. Muito útil quando se tem um proxy em execução na máquina e é preciso passar todo o tráfego do dispositivo por esta proxy. Sua síntaxe é <code class="language-plaintext highlighter-rouge">adb reverse tcp:"porta do dispositivo" tcp:"porta local"</code>. A imagem abaixo, mostra a porta TCP 8080 do dispositivo sendo direcionada para a porta TCP 8081 da máquina.</p>

<p><img src="/img/posts/mobile-20.png" alt="Tunelando portas" title="Tunelando portas" /></p>

<p>Existem outros inúmeros comandos do ADB que serão explorados futuramente, porém estes são os mais básicos para iniciar os trabalhos.</p>

<h1 id="conclusão">CONCLUSÃO</h1>

<p>Neste artigo, foi possível conhecer um pouco sobre o <code class="language-plaintext highlighter-rouge">ADB</code> e seus comandos mais básicos que formam o alicerce de técnicas mais complexas que serão abordadas futuramente. No próximo artigo, veremos algumas técnicas de engenharia reversa de aplicativos.</p>
